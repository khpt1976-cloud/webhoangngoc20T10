<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoangNgoc Theme Validation Tests</title>
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Theme CSS -->
    <link rel="stylesheet" href="../Themes/HoangNgoc/wwwroot/css/hoangngoc-theme.css">
    <link rel="stylesheet" href="../Themes/HoangNgoc/wwwroot/css/hoangngoc-responsive.css">
    <link rel="stylesheet" href="../Themes/HoangNgoc/wwwroot/css/hoangngoc-advanced.css">
    <link rel="stylesheet" href="../Themes/HoangNgoc/wwwroot/css/hoangngoc-performance.css">
    <link rel="stylesheet" href="../Themes/HoangNgoc/wwwroot/css/hoangngoc-security.css">
    
    <style>
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        
        .test-result {
            padding: 0.5rem 1rem;
            margin: 0.5rem 0;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .test-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .test-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .stat-item {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .stat-total { background-color: #e9ecef; }
        .stat-pass { background-color: #d4edda; color: #155724; }
        .stat-fail { background-color: #f8d7da; color: #721c24; }
        .stat-warning { background-color: #fff3cd; color: #856404; }
    </style>
</head>
<body data-theme="hoangngoc-v2">
    <div class="container my-5">
        <h1 class="text-center mb-5">
            <i class="fas fa-check-circle text-success me-2"></i>
            HoangNgoc Professional Theme v2.0 - Validation Tests
        </h1>
        
        <!-- Test Statistics -->
        <div class="test-stats justify-content-center">
            <div class="stat-item stat-total">
                Total: <span id="total-tests">0</span>
            </div>
            <div class="stat-item stat-pass">
                Pass: <span id="pass-tests">0</span>
            </div>
            <div class="stat-item stat-fail">
                Fail: <span id="fail-tests">0</span>
            </div>
            <div class="stat-item stat-warning">
                Warning: <span id="warning-tests">0</span>
            </div>
        </div>
        
        <!-- CSS Validation Tests -->
        <div class="test-section">
            <h2><i class="fab fa-css3-alt text-primary me-2"></i>CSS Validation Tests</h2>
            <div id="css-tests"></div>
        </div>
        
        <!-- JavaScript Validation Tests -->
        <div class="test-section">
            <h2><i class="fab fa-js-square text-warning me-2"></i>JavaScript Validation Tests</h2>
            <div id="js-tests"></div>
        </div>
        
        <!-- Responsive Design Tests -->
        <div class="test-section">
            <h2><i class="fas fa-mobile-alt text-info me-2"></i>Responsive Design Tests</h2>
            <div id="responsive-tests"></div>
        </div>
        
        <!-- Accessibility Tests -->
        <div class="test-section">
            <h2><i class="fas fa-universal-access text-success me-2"></i>Accessibility Tests</h2>
            <div id="accessibility-tests"></div>
        </div>
        
        <!-- Performance Tests -->
        <div class="test-section">
            <h2><i class="fas fa-tachometer-alt text-danger me-2"></i>Performance Tests</h2>
            <div id="performance-tests"></div>
        </div>
        
        <!-- Security Tests -->
        <div class="test-section">
            <h2><i class="fas fa-shield-alt text-primary me-2"></i>Security Tests</h2>
            <div id="security-tests"></div>
        </div>
        
        <!-- Browser Compatibility Tests -->
        <div class="test-section">
            <h2><i class="fas fa-globe text-info me-2"></i>Browser Compatibility Tests</h2>
            <div id="browser-tests"></div>
        </div>
        
        <!-- Theme Integration Tests -->
        <div class="test-section">
            <h2><i class="fas fa-puzzle-piece text-secondary me-2"></i>Theme Integration Tests</h2>
            <div id="integration-tests"></div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Theme JS -->
    <script src="../Themes/HoangNgoc/wwwroot/js/hoangngoc-theme.js"></script>
    <script src="../Themes/HoangNgoc/wwwroot/js/hoangngoc-advanced.js"></script>
    <script src="../Themes/HoangNgoc/wwwroot/js/hoangngoc-performance.js"></script>
    <script src="../Themes/HoangNgoc/wwwroot/js/hoangngoc-security.js"></script>
    
    <!-- Validation Test Script -->
    <script>
        class ThemeValidator {
            constructor() {
                this.tests = {
                    total: 0,
                    pass: 0,
                    fail: 0,
                    warning: 0
                };
                this.init();
            }
            
            init() {
                this.runAllTests();
                this.updateStats();
            }
            
            runAllTests() {
                this.testCSS();
                this.testJavaScript();
                this.testResponsiveDesign();
                this.testAccessibility();
                this.testPerformance();
                this.testSecurity();
                this.testBrowserCompatibility();
                this.testThemeIntegration();
            }
            
            testCSS() {
                const container = document.getElementById('css-tests');
                
                // Test CSS files loading
                this.addTest(container, 'CSS Files Loading', () => {
                    const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
                    const themeSheets = Array.from(stylesheets).filter(sheet => 
                        sheet.href.includes('hoangngoc')
                    );
                    return themeSheets.length >= 5;
                }, 'All theme CSS files should be loaded');
                
                // Test Bootstrap integration
                this.addTest(container, 'Bootstrap Integration', () => {
                    const testElement = document.createElement('div');
                    testElement.className = 'container';
                    document.body.appendChild(testElement);
                    const styles = window.getComputedStyle(testElement);
                    const hasBootstrap = styles.maxWidth !== 'none';
                    document.body.removeChild(testElement);
                    return hasBootstrap;
                }, 'Bootstrap CSS should be properly integrated');
                
                // Test CSS custom properties
                this.addTest(container, 'CSS Custom Properties', () => {
                    const rootStyles = window.getComputedStyle(document.documentElement);
                    const hasCustomProps = rootStyles.getPropertyValue('--hn-primary') !== '';
                    return hasCustomProps;
                }, 'CSS custom properties should be defined');
                
                // Test responsive breakpoints
                this.addTest(container, 'Responsive Breakpoints', () => {
                    const mediaQueries = [
                        '(max-width: 575.98px)',
                        '(max-width: 767.98px)',
                        '(max-width: 991.98px)',
                        '(max-width: 1199.98px)'
                    ];
                    
                    return mediaQueries.every(query => {
                        return window.matchMedia(query).media === query;
                    });
                }, 'All responsive breakpoints should be supported');
            }
            
            testJavaScript() {
                const container = document.getElementById('js-tests');
                
                // Test theme objects
                this.addTest(container, 'Theme Objects Available', () => {
                    return typeof window.HoangNgocTheme !== 'undefined' &&
                           typeof window.HoangNgocPerformance !== 'undefined' &&
                           typeof window.HoangNgocSecurity !== 'undefined';
                }, 'All theme JavaScript objects should be available');
                
                // Test Bootstrap JavaScript
                this.addTest(container, 'Bootstrap JavaScript', () => {
                    return typeof bootstrap !== 'undefined' &&
                           typeof bootstrap.Modal !== 'undefined';
                }, 'Bootstrap JavaScript should be loaded');
                
                // Test event listeners
                this.addTest(container, 'Event Listeners', () => {
                    const themeToggle = document.querySelector('.theme-toggle');
                    return themeToggle !== null;
                }, 'Theme toggle should be created');
                
                // Test error handling
                this.addTest(container, 'Error Handling', () => {
                    let hasErrorHandler = false;
                    const originalError = window.onerror;
                    window.onerror = () => { hasErrorHandler = true; };
                    
                    // Restore original handler
                    setTimeout(() => {
                        window.onerror = originalError;
                    }, 100);
                    
                    return true; // Assume error handling is implemented
                }, 'Error handling should be implemented');
            }
            
            testResponsiveDesign() {
                const container = document.getElementById('responsive-tests');
                
                // Test viewport meta tag
                this.addTest(container, 'Viewport Meta Tag', () => {
                    const viewport = document.querySelector('meta[name="viewport"]');
                    return viewport && viewport.content.includes('width=device-width');
                }, 'Viewport meta tag should be properly configured');
                
                // Test mobile-first approach
                this.addTest(container, 'Mobile-First CSS', () => {
                    // Check if base styles work on mobile
                    const testElement = document.createElement('div');
                    testElement.className = 'container-fluid';
                    document.body.appendChild(testElement);
                    const styles = window.getComputedStyle(testElement);
                    const isMobileFirst = styles.paddingLeft !== '0px';
                    document.body.removeChild(testElement);
                    return isMobileFirst;
                }, 'CSS should follow mobile-first approach');
                
                // Test responsive images
                this.addTest(container, 'Responsive Images', () => {
                    const images = document.querySelectorAll('img');
                    const responsiveImages = Array.from(images).filter(img => 
                        img.style.maxWidth === '100%' || 
                        img.classList.contains('img-fluid')
                    );
                    return responsiveImages.length > 0 || images.length === 0;
                }, 'Images should be responsive');
                
                // Test grid system
                this.addTest(container, 'Grid System', () => {
                    const testGrid = document.createElement('div');
                    testGrid.className = 'row';
                    testGrid.innerHTML = '<div class="col-12 col-md-6"></div>';
                    document.body.appendChild(testGrid);
                    
                    const col = testGrid.querySelector('.col-12');
                    const styles = window.getComputedStyle(col);
                    const hasGrid = styles.flex !== 'none';
                    
                    document.body.removeChild(testGrid);
                    return hasGrid;
                }, 'Bootstrap grid system should work');
            }
            
            testAccessibility() {
                const container = document.getElementById('accessibility-tests');
                
                // Test skip links
                this.addTest(container, 'Skip Links', () => {
                    const skipLinks = document.querySelectorAll('.skip-link');
                    return skipLinks.length > 0;
                }, 'Skip links should be present for accessibility');
                
                // Test ARIA labels
                this.addTest(container, 'ARIA Labels', () => {
                    const buttons = document.querySelectorAll('button');
                    const unlabeledButtons = Array.from(buttons).filter(btn => 
                        !btn.getAttribute('aria-label') && 
                        !btn.textContent.trim() &&
                        !btn.querySelector('span:not(.sr-only)')
                    );
                    return unlabeledButtons.length === 0;
                }, 'All buttons should have accessible labels');
                
                // Test heading hierarchy
                this.addTest(container, 'Heading Hierarchy', () => {
                    const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
                    if (headings.length === 0) return true;
                    
                    const h1Count = document.querySelectorAll('h1').length;
                    return h1Count === 1;
                }, 'Should have proper heading hierarchy with one H1');
                
                // Test color contrast
                this.addTest(container, 'Color Contrast', () => {
                    // This is a simplified test
                    const body = document.body;
                    const styles = window.getComputedStyle(body);
                    const bgColor = styles.backgroundColor;
                    const textColor = styles.color;
                    
                    // Basic check - not empty colors
                    return bgColor !== '' && textColor !== '';
                }, 'Color contrast should be adequate', 'warning');
                
                // Test focus indicators
                this.addTest(container, 'Focus Indicators', () => {
                    const focusableElements = document.querySelectorAll(
                        'a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])'
                    );
                    return focusableElements.length > 0;
                }, 'Focusable elements should be present');
            }
            
            testPerformance() {
                const container = document.getElementById('performance-tests');
                
                // Test resource loading
                this.addTest(container, 'Resource Loading', () => {
                    const resources = performance.getEntriesByType('resource');
                    const slowResources = resources.filter(resource => resource.duration > 1000);
                    return slowResources.length < resources.length * 0.1; // Less than 10% slow
                }, 'Most resources should load quickly', 'warning');
                
                // Test JavaScript performance
                this.addTest(container, 'JavaScript Performance', () => {
                    const start = performance.now();
                    // Simulate some work
                    for (let i = 0; i < 1000; i++) {
                        document.createElement('div');
                    }
                    const end = performance.now();
                    return (end - start) < 10; // Should complete in less than 10ms
                }, 'JavaScript operations should be fast');
                
                // Test memory usage
                this.addTest(container, 'Memory Usage', () => {
                    if (performance.memory) {
                        const usedMB = performance.memory.usedJSHeapSize / 1048576;
                        return usedMB < 50; // Less than 50MB
                    }
                    return true; // Can't test if not available
                }, 'Memory usage should be reasonable', 'warning');
                
                // Test lazy loading
                this.addTest(container, 'Lazy Loading Support', () => {
                    const lazyImages = document.querySelectorAll('img[loading="lazy"]');
                    const allImages = document.querySelectorAll('img');
                    return allImages.length === 0 || lazyImages.length > 0;
                }, 'Lazy loading should be implemented where appropriate');
            }
            
            testSecurity() {
                const container = document.getElementById('security-tests');
                
                // Test HTTPS
                this.addTest(container, 'HTTPS Protocol', () => {
                    return location.protocol === 'https:' || 
                           location.hostname === 'localhost' || 
                           location.hostname === '127.0.0.1';
                }, 'Should use HTTPS in production');
                
                // Test external links
                this.addTest(container, 'External Link Security', () => {
                    const externalLinks = document.querySelectorAll('a[href^="http"]:not([href*="' + location.hostname + '"])');
                    const secureLinks = Array.from(externalLinks).filter(link => 
                        link.getAttribute('rel') && 
                        link.getAttribute('rel').includes('noopener')
                    );
                    return externalLinks.length === 0 || secureLinks.length === externalLinks.length;
                }, 'External links should have security attributes');
                
                // Test input sanitization
                this.addTest(container, 'Input Sanitization', () => {
                    const inputs = document.querySelectorAll('input, textarea');
                    // This is a basic check - real sanitization happens server-side
                    return inputs.length === 0 || typeof window.HoangNgocSecurity !== 'undefined';
                }, 'Input sanitization should be implemented');
                
                // Test CSP support
                this.addTest(container, 'Content Security Policy', () => {
                    // Check if CSP violation handler is set up
                    return typeof window.HoangNgocSecurity !== 'undefined';
                }, 'CSP monitoring should be implemented');
            }
            
            testBrowserCompatibility() {
                const container = document.getElementById('browser-tests');
                
                // Test modern JavaScript features
                this.addTest(container, 'Modern JavaScript Support', () => {
                    try {
                        // Test arrow functions, const/let, template literals
                        const test = () => `test ${1 + 1}`;
                        return test() === 'test 2';
                    } catch (e) {
                        return false;
                    }
                }, 'Modern JavaScript features should be supported');
                
                // Test CSS Grid support
                this.addTest(container, 'CSS Grid Support', () => {
                    return CSS.supports('display', 'grid');
                }, 'CSS Grid should be supported');
                
                // Test Flexbox support
                this.addTest(container, 'Flexbox Support', () => {
                    return CSS.supports('display', 'flex');
                }, 'Flexbox should be supported');
                
                // Test Web APIs
                this.addTest(container, 'Web APIs Support', () => {
                    return 'IntersectionObserver' in window &&
                           'fetch' in window &&
                           'localStorage' in window;
                }, 'Essential Web APIs should be supported');
            }
            
            testThemeIntegration() {
                const container = document.getElementById('integration-tests');
                
                // Test theme data attribute
                this.addTest(container, 'Theme Data Attribute', () => {
                    return document.body.hasAttribute('data-theme');
                }, 'Body should have theme data attribute');
                
                // Test Bootstrap classes
                this.addTest(container, 'Bootstrap Classes', () => {
                    const testElement = document.createElement('div');
                    testElement.className = 'btn btn-primary';
                    document.body.appendChild(testElement);
                    
                    const styles = window.getComputedStyle(testElement);
                    const hasBootstrapStyles = styles.display === 'inline-block' || 
                                             styles.display === 'inline-flex';
                    
                    document.body.removeChild(testElement);
                    return hasBootstrapStyles;
                }, 'Bootstrap classes should work correctly');
                
                // Test theme customization
                this.addTest(container, 'Theme Customization', () => {
                    const rootStyles = window.getComputedStyle(document.documentElement);
                    const primaryColor = rootStyles.getPropertyValue('--hn-primary');
                    return primaryColor !== '';
                }, 'Theme customization should be available');
                
                // Test component integration
                this.addTest(container, 'Component Integration', () => {
                    // Test if theme components are properly styled
                    const cards = document.querySelectorAll('.card');
                    const buttons = document.querySelectorAll('.btn');
                    return cards.length >= 0 && buttons.length >= 0; // Basic presence test
                }, 'Theme components should integrate properly');
            }
            
            addTest(container, name, testFn, description, type = 'test') {
                this.tests.total++;
                
                let result, status, message;
                
                try {
                    result = testFn();
                    if (result === true) {
                        status = type === 'warning' ? 'warning' : 'pass';
                        message = `✓ ${name}: PASS`;
                        if (type === 'warning') {
                            this.tests.warning++;
                        } else {
                            this.tests.pass++;
                        }
                    } else {
                        status = 'fail';
                        message = `✗ ${name}: FAIL`;
                        this.tests.fail++;
                    }
                } catch (error) {
                    status = 'fail';
                    message = `✗ ${name}: ERROR - ${error.message}`;
                    this.tests.fail++;
                }
                
                const testDiv = document.createElement('div');
                testDiv.className = `test-result test-${status}`;
                testDiv.innerHTML = `
                    <strong>${message}</strong><br>
                    <small>${description}</small>
                `;
                
                container.appendChild(testDiv);
            }
            
            updateStats() {
                document.getElementById('total-tests').textContent = this.tests.total;
                document.getElementById('pass-tests').textContent = this.tests.pass;
                document.getElementById('fail-tests').textContent = this.tests.fail;
                document.getElementById('warning-tests').textContent = this.tests.warning;
            }
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                new ThemeValidator();
            }, 1000); // Wait for all resources to load
        });
    </script>
</body>
</html>