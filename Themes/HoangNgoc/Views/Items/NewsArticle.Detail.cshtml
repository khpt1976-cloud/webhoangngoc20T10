@using HoangNgoc.News.Models
@using OrchardCore.ContentManagement
@using Microsoft.AspNetCore.Html

@{
    ContentItem contentItem = Model.ContentItem;
    var newsArticlePart = contentItem.As<NewsArticlePart>();
    var title = contentItem.DisplayText;
    var content = newsArticlePart?.Content?.Value ?? "";
    var summary = newsArticlePart?.Summary?.Value ?? "";
    var imageUrl = newsArticlePart?.FeaturedImage?.Paths?.FirstOrDefault() ?? "/Themes/HoangNgoc/wwwroot/images/placeholder-news.jpg";
    var publishedDate = contentItem.PublishedUtc?.ToString("dd/MM/yyyy HH:mm") ?? "";
    var author = newsArticlePart?.Author?.Text ?? "Admin";
    var category = newsArticlePart?.Category?.Text ?? "Tin tức";
    var viewCount = newsArticlePart?.ViewCount ?? 0;
    var tags = newsArticlePart?.Tags?.Values ?? new string[0];
}

<article class="news-article-detail" itemscope itemtype="https://schema.org/NewsArticle">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Trang chủ</a></li>
            <li class="breadcrumb-item"><a href="/news" class="text-decoration-none">Tin tức</a></li>
            <li class="breadcrumb-item"><a href="/news/category/@category.ToLower()" class="text-decoration-none">@category</a></li>
            <li class="breadcrumb-item active" aria-current="page">@title</li>
        </ol>
    </nav>

    <!-- Article Header -->
    <header class="article-header mb-5">
        <!-- Category Badge -->
        <div class="mb-3">
            <span class="badge bg-primary rounded-pill px-3 py-2 fs-6">
                <i class="fas fa-tag me-2"></i>@category
            </span>
        </div>
        
        <!-- Article Title -->
        <h1 class="article-title display-4 fw-bold mb-4" itemprop="headline">@title</h1>
        
        <!-- Article Summary -->
        @if (!string.IsNullOrEmpty(summary))
        {
            <div class="article-summary lead text-muted mb-4" itemprop="description">
                @Html.Raw(summary)
            </div>
        }
        
        <!-- Article Meta -->
        <div class="article-meta d-flex flex-wrap align-items-center gap-4 mb-4 pb-4 border-bottom">
            <div class="meta-item d-flex align-items-center">
                <div class="author-avatar bg-primary rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px;">
                    <i class="fas fa-user text-white"></i>
                </div>
                <div>
                    <div class="fw-semibold" itemprop="author">@author</div>
                    <small class="text-muted">Tác giả</small>
                </div>
            </div>
            
            <div class="meta-item">
                <i class="fas fa-calendar-alt text-primary me-2"></i>
                <div>
                    <time datetime="@contentItem.PublishedUtc?.ToString("yyyy-MM-dd")" itemprop="datePublished" class="fw-semibold">@publishedDate</time>
                    <div><small class="text-muted">Ngày đăng</small></div>
                </div>
            </div>
            
            <div class="meta-item">
                <i class="fas fa-eye text-primary me-2"></i>
                <div>
                    <div class="fw-semibold">@viewCount.ToString("N0")</div>
                    <div><small class="text-muted">Lượt xem</small></div>
                </div>
            </div>
            
            <div class="meta-item">
                <i class="fas fa-clock text-primary me-2"></i>
                <div>
                    <div class="fw-semibold">5 phút</div>
                    <div><small class="text-muted">Thời gian đọc</small></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Featured Image -->
    @if (!string.IsNullOrEmpty(imageUrl))
    {
        <div class="article-featured-image mb-5">
            <figure class="figure w-100">
                <img src="@imageUrl" 
                     class="figure-img img-fluid rounded shadow-sm w-100" 
                     alt="@title"
                     itemprop="image"
                     style="max-height: 500px; object-fit: cover;" />
                <figcaption class="figure-caption text-center mt-2 text-muted">
                    <i class="fas fa-image me-1"></i>@title
                </figcaption>
            </figure>
        </div>
    }

    <!-- Article Content -->
    <div class="article-content mb-5" itemprop="articleBody">
        <div class="content-wrapper">
            @if (!string.IsNullOrEmpty(content))
            {
                @Html.Raw(content)
            }
            else
            {
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Nội dung bài viết đang được cập nhật...
                </div>
            }
        </div>
    </div>

    <!-- Article Tags -->
    @if (tags.Any())
    {
        <div class="article-tags mb-5">
            <h5 class="mb-3">
                <i class="fas fa-tags text-primary me-2"></i>Thẻ bài viết
            </h5>
            <div class="tags-wrapper">
                @foreach (var tag in tags)
                {
                    <a href="/news/tag/@tag.ToLower()" class="badge bg-light text-dark text-decoration-none me-2 mb-2 px-3 py-2 fs-6 hover-tag">
                        <i class="fas fa-hashtag me-1"></i>@tag
                    </a>
                }
            </div>
        </div>
    }

    <!-- Social Share -->
    <div class="article-share mb-5 p-4 bg-light rounded">
        <h5 class="mb-3">
            <i class="fas fa-share-alt text-primary me-2"></i>Chia sẻ bài viết
        </h5>
        <div class="share-buttons d-flex flex-wrap gap-2">
            <a href="#" class="btn btn-primary btn-sm share-btn" data-platform="facebook">
                <i class="fab fa-facebook-f me-1"></i>Facebook
            </a>
            <a href="#" class="btn btn-info btn-sm share-btn" data-platform="twitter">
                <i class="fab fa-twitter me-1"></i>Twitter
            </a>
            <a href="#" class="btn btn-success btn-sm share-btn" data-platform="whatsapp">
                <i class="fab fa-whatsapp me-1"></i>WhatsApp
            </a>
            <a href="#" class="btn btn-secondary btn-sm share-btn" data-platform="linkedin">
                <i class="fab fa-linkedin-in me-1"></i>LinkedIn
            </a>
            <button class="btn btn-outline-secondary btn-sm" onclick="copyToClipboard()">
                <i class="fas fa-copy me-1"></i>Copy Link
            </button>
        </div>
    </div>

    <!-- Article Navigation -->
    <nav class="article-navigation mb-5">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="nav-item prev-article p-3 border rounded">
                    <div class="nav-label small text-muted mb-1">
                        <i class="fas fa-chevron-left me-1"></i>Bài trước
                    </div>
                    <a href="#" class="nav-title text-decoration-none fw-semibold">
                        Tiêu đề bài viết trước đó
                    </a>
                </div>
            </div>
            <div class="col-md-6">
                <div class="nav-item next-article p-3 border rounded text-md-end">
                    <div class="nav-label small text-muted mb-1">
                        Bài tiếp <i class="fas fa-chevron-right ms-1"></i>
                    </div>
                    <a href="#" class="nav-title text-decoration-none fw-semibold">
                        Tiêu đề bài viết tiếp theo
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Related Articles -->
    <section class="related-articles mb-5">
        <h4 class="mb-4">
            <i class="fas fa-newspaper text-primary me-2"></i>Bài viết liên quan
        </h4>
        <div class="row g-4">
            @for (int i = 1; i <= 3; i++)
            {
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm hover-lift">
                        <img src="/Themes/HoangNgoc/wwwroot/images/placeholder-news.jpg" 
                             class="card-img-top" 
                             alt="Related Article @i"
                             style="height: 150px; object-fit: cover;" />
                        <div class="card-body">
                            <h6 class="card-title">
                                <a href="#" class="text-decoration-none text-dark">
                                    Tiêu đề bài viết liên quan @i
                                </a>
                            </h6>
                            <p class="card-text small text-muted">
                                Tóm tắt ngắn gọn về nội dung bài viết liên quan...
                            </p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <i class="fas fa-calendar-alt me-1"></i>@DateTime.Now.AddDays(-i).ToString("dd/MM/yyyy")
                                </small>
                                <small class="text-muted">
                                    <i class="fas fa-eye me-1"></i>@((i * 123).ToString("N0"))
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </section>
</article>

<style>
.article-title {
    line-height: 1.2;
    color: #2c3e50;
}

.article-meta .meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.content-wrapper {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #444;
}

.content-wrapper h2,
.content-wrapper h3,
.content-wrapper h4 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    color: #2c3e50;
}

.content-wrapper p {
    margin-bottom: 1.5rem;
}

.content-wrapper img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    margin: 1.5rem 0;
}

.hover-tag {
    transition: all 0.3s ease;
}

.hover-tag:hover {
    background-color: var(--bs-primary) !important;
    color: white !important;
    transform: translateY(-2px);
}

.share-btn {
    transition: transform 0.3s ease;
}

.share-btn:hover {
    transform: translateY(-2px);
}

.hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

.nav-item {
    transition: all 0.3s ease;
}

.nav-item:hover {
    background-color: #f8f9fa;
    border-color: var(--bs-primary) !important;
}

@media (max-width: 768px) {
    .article-title {
        font-size: 2rem;
    }
    
    .article-meta {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 1rem !important;
    }
    
    .share-buttons {
        justify-content: center;
    }
    
    .content-wrapper {
        font-size: 1rem;
    }
}
</style>

<script>
function copyToClipboard() {
    navigator.clipboard.writeText(window.location.href).then(function() {
        // Show success message
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check me-1"></i>Đã copy!';
        btn.classList.add('btn-success');
        btn.classList.remove('btn-outline-secondary');
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-outline-secondary');
        }, 2000);
    });
}

// Social share functionality
document.querySelectorAll('.share-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        const platform = this.dataset.platform;
        const url = encodeURIComponent(window.location.href);
        const title = encodeURIComponent(document.title);
        
        let shareUrl = '';
        switch(platform) {
            case 'facebook':
                shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                break;
            case 'twitter':
                shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
                break;
            case 'whatsapp':
                shareUrl = `https://wa.me/?text=${title} ${url}`;
                break;
            case 'linkedin':
                shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
                break;
        }
        
        if (shareUrl) {
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }
    });
});
</script>