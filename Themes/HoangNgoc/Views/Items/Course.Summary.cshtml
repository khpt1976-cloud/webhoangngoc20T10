@using HoangNgoc.Training.Models
@using OrchardCore.ContentManagement
@using Microsoft.AspNetCore.Html

@{
    ContentItem contentItem = Model.ContentItem;
    var coursePart = contentItem.As<CoursePart>();
    var title = contentItem.DisplayText;
    var description = coursePart?.Description?.Value ?? "";
    var imageUrl = coursePart?.ThumbnailImage?.Paths?.FirstOrDefault() ?? "/Themes/HoangNgoc/wwwroot/images/placeholder-course.jpg";
    var instructor = coursePart?.Instructor?.Text ?? "Giảng viên";
    var duration = coursePart?.Duration ?? 0;
    var price = coursePart?.Price ?? 0;
    var level = coursePart?.Level?.Text ?? "Cơ bản";
    var enrollmentCount = coursePart?.EnrollmentCount ?? 0;
    var rating = coursePart?.Rating ?? 4.5;
    var category = coursePart?.Category?.Text ?? "Khóa học";
}

<div class="course-summary card h-100 shadow-sm border-0 hover-lift" itemscope itemtype="https://schema.org/Course">
    <!-- Course Image -->
    <div class="course-image-wrapper position-relative overflow-hidden">
        <img src="@imageUrl" 
             class="card-img-top course-thumbnail" 
             alt="@title"
             loading="lazy"
             itemprop="image"
             style="height: 200px; object-fit: cover;" />
        
        <!-- Level Badge -->
        <div class="position-absolute top-0 start-0 m-3">
            <span class="badge bg-success rounded-pill px-3 py-2 shadow-sm">
                <i class="fas fa-signal me-1"></i>@level
            </span>
        </div>
        
        <!-- Price Badge -->
        <div class="position-absolute top-0 end-0 m-3">
            @if (price > 0)
            {
                <span class="badge bg-warning text-dark rounded-pill px-3 py-2 shadow-sm fw-bold">
                    @price.ToString("N0") VNĐ
                </span>
            }
            else
            {
                <span class="badge bg-success rounded-pill px-3 py-2 shadow-sm fw-bold">
                    Miễn phí
                </span>
            }
        </div>
        
        <!-- Play Button Overlay -->
        <div class="position-absolute top-50 start-50 translate-middle">
            <div class="play-button bg-white bg-opacity-90 rounded-circle d-flex align-items-center justify-content-center shadow" 
                 style="width: 60px; height: 60px;">
                <i class="fas fa-play text-primary fs-4"></i>
            </div>
        </div>
    </div>
    
    <div class="card-body d-flex flex-column">
        <!-- Course Category -->
        <div class="course-category mb-2">
            <span class="badge bg-light text-primary border border-primary">
                <i class="fas fa-folder me-1"></i>@category
            </span>
        </div>
        
        <!-- Course Title -->
        <h4 class="card-title course-title mb-3" itemprop="name">
            <a href="@Url.RouteUrl(new { area = "OrchardCore.Contents", controller = "Item", action = "Display", contentItemId = contentItem.ContentItemId })" 
               class="text-decoration-none text-dark stretched-link">
                @title
            </a>
        </h4>
        
        <!-- Course Description -->
        <div class="course-description text-muted mb-4 flex-grow-1" itemprop="description">
            @if (!string.IsNullOrEmpty(description))
            {
                <p class="mb-0">@Html.Raw(description.Length > 120 ? description.Substring(0, 120) + "..." : description)</p>
            }
            else
            {
                <p class="mb-0">Khám phá kiến thức mới với khóa học chất lượng cao...</p>
            }
        </div>
        
        <!-- Course Meta Info -->
        <div class="course-meta mb-3">
            <div class="row g-2 text-center">
                <div class="col-4">
                    <div class="meta-item">
                        <i class="fas fa-clock text-primary d-block mb-1"></i>
                        <small class="fw-semibold">@duration giờ</small>
                        <div class="small text-muted">Thời lượng</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="meta-item">
                        <i class="fas fa-users text-success d-block mb-1"></i>
                        <small class="fw-semibold">@enrollmentCount.ToString("N0")</small>
                        <div class="small text-muted">Học viên</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="meta-item">
                        <i class="fas fa-star text-warning d-block mb-1"></i>
                        <small class="fw-semibold">@rating.ToString("F1")</small>
                        <div class="small text-muted">Đánh giá</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Instructor Info -->
        <div class="instructor-info d-flex align-items-center mb-3 p-2 bg-light rounded">
            <div class="instructor-avatar bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" 
                 style="width: 40px; height: 40px;">
                <i class="fas fa-user-tie text-white"></i>
            </div>
            <div>
                <div class="fw-semibold small" itemprop="instructor">@instructor</div>
                <div class="text-muted small">Giảng viên</div>
            </div>
        </div>
        
        <!-- Course Actions -->
        <div class="course-actions d-flex gap-2">
            <button class="btn btn-primary flex-grow-1">
                <i class="fas fa-play me-1"></i>Học ngay
            </button>
            <button class="btn btn-outline-secondary" title="Thêm vào yêu thích">
                <i class="fas fa-heart"></i>
            </button>
            <button class="btn btn-outline-secondary" title="Chia sẻ">
                <i class="fas fa-share-alt"></i>
            </button>
        </div>
    </div>
    
    <!-- Course Progress (if enrolled) -->
    <div class="card-footer bg-transparent border-0 pt-0" style="display: none;">
        <div class="progress" style="height: 6px;">
            <div class="progress-bar bg-success" role="progressbar" style="width: 35%" aria-valuenow="35" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="d-flex justify-content-between mt-2">
            <small class="text-muted">Tiến độ: 35%</small>
            <small class="text-muted">7/20 bài học</small>
        </div>
    </div>
</div>

<style>
.course-summary {
    transition: all 0.3s ease;
    border-radius: 12px;
    overflow: hidden;
}

.course-summary:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

.course-image-wrapper {
    border-radius: 12px 12px 0 0;
    position: relative;
}

.course-thumbnail {
    transition: transform 0.3s ease;
}

.course-summary:hover .course-thumbnail {
    transform: scale(1.05);
}

.play-button {
    opacity: 0;
    transition: all 0.3s ease;
    transform: translate(-50%, -50%) scale(0.8);
}

.course-summary:hover .play-button {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

.course-title a {
    transition: color 0.3s ease;
}

.course-title a:hover {
    color: var(--bs-primary) !important;
}

.meta-item {
    padding: 0.5rem;
    border-radius: 8px;
    transition: background-color 0.3s ease;
}

.meta-item:hover {
    background-color: rgba(13, 110, 253, 0.1);
}

.instructor-info {
    transition: all 0.3s ease;
}

.instructor-info:hover {
    background-color: rgba(13, 110, 253, 0.1) !important;
}

.course-actions .btn {
    transition: all 0.3s ease;
}

.course-actions .btn:hover {
    transform: translateY(-2px);
}

.hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

@media (max-width: 768px) {
    .course-meta .row {
        text-align: center;
    }
    
    .course-actions {
        flex-direction: column;
    }
    
    .course-actions .btn {
        width: 100%;
    }
}
</style>