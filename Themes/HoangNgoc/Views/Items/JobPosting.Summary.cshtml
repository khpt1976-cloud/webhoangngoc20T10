@using HoangNgoc.Application.Models
@using OrchardCore.ContentManagement
@using Microsoft.AspNetCore.Html

@{
    ContentItem contentItem = Model.ContentItem;
    var jobPart = contentItem.As<JobPostingPart>();
    var title = contentItem.DisplayText;
    var description = jobPart?.Description?.Value ?? "";
    var company = jobPart?.Company?.Text ?? "Công ty ABC";
    var location = jobPart?.Location?.Text ?? "TP.HCM";
    var salary = jobPart?.Salary?.Text ?? "Thỏa thuận";
    var jobType = jobPart?.JobType?.Text ?? "Toàn thời gian";
    var experience = jobPart?.Experience?.Text ?? "1-3 năm";
    var deadline = jobPart?.Deadline?.Value?.ToString("dd/MM/yyyy") ?? "";
    var postedDate = contentItem.PublishedUtc?.ToString("dd/MM/yyyy") ?? "";
    var isUrgent = jobPart?.IsUrgent ?? false;
    var isRemote = jobPart?.IsRemote ?? false;
    var applicationCount = jobPart?.ApplicationCount ?? 0;
}

<div class="job-posting-summary card h-100 shadow-sm border-0 hover-lift" itemscope itemtype="https://schema.org/JobPosting">
    <div class="card-body">
        <!-- Job Header -->
        <div class="job-header mb-3">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <!-- Company Logo & Info -->
                <div class="d-flex align-items-center">
                    <div class="company-logo bg-primary rounded d-flex align-items-center justify-content-center me-3" 
                         style="width: 50px; height: 50px;">
                        <i class="fas fa-building text-white"></i>
                    </div>
                    <div>
                        <h5 class="company-name mb-1" itemprop="hiringOrganization">@company</h5>
                        <div class="job-location text-muted small">
                            <i class="fas fa-map-marker-alt me-1"></i>
                            <span itemprop="jobLocation">@location</span>
                        </div>
                    </div>
                </div>
                
                <!-- Job Badges -->
                <div class="job-badges">
                    @if (isUrgent)
                    {
                        <span class="badge bg-danger rounded-pill mb-1">
                            <i class="fas fa-exclamation-triangle me-1"></i>Gấp
                        </span>
                    }
                    @if (isRemote)
                    {
                        <span class="badge bg-info rounded-pill mb-1">
                            <i class="fas fa-home me-1"></i>Remote
                        </span>
                    }
                </div>
            </div>
        </div>
        
        <!-- Job Title -->
        <h4 class="job-title mb-3" itemprop="title">
            <a href="@Url.RouteUrl(new { area = "OrchardCore.Contents", controller = "Item", action = "Display", contentItemId = contentItem.ContentItemId })" 
               class="text-decoration-none text-dark stretched-link">
                @title
            </a>
        </h4>
        
        <!-- Job Description -->
        <div class="job-description text-muted mb-4" itemprop="description">
            @if (!string.IsNullOrEmpty(description))
            {
                <p class="mb-0">@Html.Raw(description.Length > 150 ? description.Substring(0, 150) + "..." : description)</p>
            }
            else
            {
                <p class="mb-0">Cơ hội việc làm hấp dẫn đang chờ đón bạn...</p>
            }
        </div>
        
        <!-- Job Details -->
        <div class="job-details mb-4">
            <div class="row g-3">
                <div class="col-6">
                    <div class="detail-item d-flex align-items-center">
                        <i class="fas fa-money-bill-wave text-success me-2"></i>
                        <div>
                            <small class="text-muted d-block">Mức lương</small>
                            <span class="fw-semibold" itemprop="baseSalary">@salary</span>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="detail-item d-flex align-items-center">
                        <i class="fas fa-briefcase text-primary me-2"></i>
                        <div>
                            <small class="text-muted d-block">Loại hình</small>
                            <span class="fw-semibold" itemprop="employmentType">@jobType</span>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="detail-item d-flex align-items-center">
                        <i class="fas fa-user-clock text-warning me-2"></i>
                        <div>
                            <small class="text-muted d-block">Kinh nghiệm</small>
                            <span class="fw-semibold" itemprop="experienceRequirements">@experience</span>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="detail-item d-flex align-items-center">
                        <i class="fas fa-users text-info me-2"></i>
                        <div>
                            <small class="text-muted d-block">Ứng viên</small>
                            <span class="fw-semibold">@applicationCount.ToString("N0")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Job Meta -->
        <div class="job-meta d-flex justify-content-between align-items-center mb-3 p-2 bg-light rounded">
            <div class="posted-date">
                <i class="fas fa-calendar-alt text-muted me-1"></i>
                <small class="text-muted">
                    Đăng: <time datetime="@contentItem.PublishedUtc?.ToString("yyyy-MM-dd")" itemprop="datePosted">@postedDate</time>
                </small>
            </div>
            @if (!string.IsNullOrEmpty(deadline))
            {
                <div class="deadline">
                    <i class="fas fa-clock text-danger me-1"></i>
                    <small class="text-danger fw-semibold">
                        Hạn: <time datetime="@jobPart?.Deadline?.Value?.ToString("yyyy-MM-dd")" itemprop="validThrough">@deadline</time>
                    </small>
                </div>
            }
        </div>
        
        <!-- Job Actions -->
        <div class="job-actions d-flex gap-2">
            <button class="btn btn-primary flex-grow-1">
                <i class="fas fa-paper-plane me-1"></i>Ứng tuyển ngay
            </button>
            <button class="btn btn-outline-secondary" title="Lưu việc làm">
                <i class="fas fa-bookmark"></i>
            </button>
            <button class="btn btn-outline-secondary" title="Chia sẻ">
                <i class="fas fa-share-alt"></i>
            </button>
        </div>
    </div>
    
    <!-- Job Skills/Tags -->
    @if (jobPart?.Skills?.Values?.Any() == true)
    {
        <div class="card-footer bg-transparent border-0">
            <div class="job-skills">
                <small class="text-muted mb-2 d-block">
                    <i class="fas fa-tags me-1"></i>Kỹ năng yêu cầu:
                </small>
                <div class="skills-wrapper">
                    @foreach (var skill in jobPart.Skills.Values.Take(4))
                    {
                        <span class="badge bg-light text-dark border me-1 mb-1">@skill</span>
                    }
                    @if (jobPart.Skills.Values.Count() > 4)
                    {
                        <span class="badge bg-secondary">+@(jobPart.Skills.Values.Count() - 4)</span>
                    }
                </div>
            </div>
        </div>
    }
</div>

<style>
.job-posting-summary {
    transition: all 0.3s ease;
    border-radius: 12px;
    overflow: hidden;
}

.job-posting-summary:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

.company-logo {
    transition: all 0.3s ease;
}

.job-posting-summary:hover .company-logo {
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.job-title a {
    transition: color 0.3s ease;
}

.job-title a:hover {
    color: var(--bs-primary) !important;
}

.detail-item {
    padding: 0.5rem;
    border-radius: 8px;
    transition: background-color 0.3s ease;
}

.detail-item:hover {
    background-color: rgba(13, 110, 253, 0.05);
}

.job-actions .btn {
    transition: all 0.3s ease;
}

.job-actions .btn:hover {
    transform: translateY(-2px);
}

.job-badges .badge {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.skills-wrapper .badge {
    transition: all 0.3s ease;
}

.skills-wrapper .badge:hover {
    background-color: var(--bs-primary) !important;
    color: white !important;
    transform: translateY(-2px);
}

.hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

@media (max-width: 768px) {
    .job-header .d-flex {
        flex-direction: column;
        align-items: flex-start !important;
    }
    
    .job-badges {
        margin-top: 1rem;
        align-self: flex-start;
    }
    
    .job-meta {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 0.5rem;
    }
    
    .job-actions {
        flex-direction: column;
    }
    
    .job-actions .btn {
        width: 100%;
    }
}
</style>